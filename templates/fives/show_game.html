{% extends 'fives/base.html' %}
{% load staticfiles %}

{% block title_block %}
    {{ game.custom_slug }}
{% endblock %}

{% block body_block %}
{% if game %}
    <div class="game-head-wrapper">
        <div class="game-head-title">
            {{ game.host.first_name }}&nbsp;&#9675;&nbsp;{{ game.date|date:"d N Y" }}&nbsp;&#9675;&nbsp;{{ game.start_time }}
        </div>
        <div class="game-head-host">
            Host: {{ game.host.username }}
        </div>
    </div>
    <div class="game-info">
        Date: {{ game.date|date:"d M Y" }}<br />
        Time: {{ game.start_time }}<br />
        Pitch:
        {% if game.booked %}
            <span style="color:Green">Booked</span><br />
        {% else %}
            <span style="color:Red">Not Booked</span><br />
        {% endif %}
        Price/person: {{ game.price }}
    </div>
    <div class="game-address">
        Address:<br />
        {{ game.street }}<br />
        {{ game.city }}<br />
        {{ game.postcode }}
    </div>
    <div class="game-map">
        <div id="map-display" data-latitude="{{ game.latitude }}" data-longitude="{{ game.longitude }}" style="width: 600px; height: 200px;">
            <div id="map" >
            </div>
        </div>
    </div>

    <div class="game-players-wrapper">
        <table class="game-player-table">
            <tr>
                <th>Name</th>
                <th>Surame</th>
                <th>Skill</th>
                <th>Likes</th>
                <th>Punctuality</th>
            </tr>
        {% for player in participants %}
            <tr>
                <td>{{ player.user.first_name }}</td>
                <td>{{ player.user.last_name }}</td>
                <td>{{ player.skill }}</td>
                <td>{{ player.likeability }}</td>
                <td>{{ player.reliability }}</td>
                
                {% if user == game.host %}
                <td>
                    {% if user != player.user %}
                        <button type="button" id="removeBtn" data-gameid="{{ game.game_id }}" 
                        data-username="{{ player.user.username }}" >
                            Remove Player
                       </button>
                    {% endif %}
                </td>
                {% endif %}
            </tr>
        {% endfor %}
        </table>
        <span class="span-free-slots">Free spaces: <strong>{{ game.free_slots }}</strong></span>
    </div>
    <div class="game-player-static">
        <div class="game-player-buttons">
            {% if user.is_authenticated %}
                {% if user == game.host %}
                    <button type="button" id="deleteBtn" data-gameid="{{ game.game_id }}" 
                    data-username="{{ user.username }}" >
                        Delete Game
                    </button>
                {% else %}
                    {% if user in users %}
                        <button type="button" id="leaveBtn" data-gameid="{{ game.game_id }}"
                        data-username="{{ user.username }}" >
                            Leave Game
                        </button>
                    {% else %}
                        <button type="button" id="joinBtn" data-gameid="{{ game.game_id }}"
                        data-username="{{ user.username }}" >
                            Join Game
                        </button>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>
{% else %}
    The specified game does not exist!
{% endif %}

<!-- Move the following to main.js -->

<script>
    var map
    function initMap() {
        var mapDisplay = document.getElementById("map-display"); 

        var latitude = mapDisplay.getAttribute("data-latitude");
        var longitude = mapDisplay.getAttribute("data-longitude");
        var thisLatLng = {lat: parseFloat(latitude), lng: parseFloat(longitude)};

        var mapOptions = {
            center: thisLatLng,
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        map = new google.maps.Map(mapDisplay, mapOptions);

        var marker = new google.maps.Marker({
          position: thisLatLng,
          map: map,
        });
    }

</script>
<script type="text/javascript" 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUX2r2xDl7hy2QUQOyzS7ACOPLUqWWEDw&callback=initMap"
    async defer>
</script>


{% endblock %}
